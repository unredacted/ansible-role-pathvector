---
- name: Converge
  hosts: all
  become: true
  vars:
    pathvector_skip_install: true
    pathvector_debug: true
    pathvector_run_script: false
    pathvector_config_path: /etc/pathvector.yml
    pathvector_deploy_only: false
  
  pre_tasks:
    - name: Create local files directory
      ansible.builtin.file:
        path: "{{ playbook_dir }}/files"
        state: directory
        mode: '0755'
      delegate_to: localhost
      become: false
      run_once: true
    
    - name: Create test config file for instance
      ansible.builtin.copy:
        dest: "{{ playbook_dir }}/files/instance.yml"
        content: |
          asn: 65001
          router-id: 10.0.0.1
          source4: 10.0.0.1
          source6: fd00::1
          prefixes:
            - 10.0.0.0/24
      delegate_to: localhost
      become: false
      run_once: true
  
  tasks:
    - name: Import pathvector role tasks
      ansible.builtin.import_tasks: ../../tasks/main.yml
  
  handlers:
    - name: Import handlers
      ansible.builtin.import_tasks: ../../handlers/main.yml